<div style="position: relative;">
    <div>
        <form [formGroup]="dropdownForm">
            <div class="card-container" [title]="c.displayLabel">
                <div class="icon-container">
                    <img [src]="'imgs/form-fields/'+c.iconName" height="30px" alt="">
                </div>
                <div class="card-heading">
                    <div *ngIf="!showNameInput" (click)="onNameClick()">{{c.name}}</div>
                    <input #nameInput *ngIf="showNameInput" (focusout)="onNameFocusOut()" class="form-control"
                        [id]="c.id+'-name'" formControlName="name" placeholder="Give a name to this component">
                </div>
                <div class="actions-container">
                    <button (click)="c.showMetadataDiv = !c.showMetadataDiv">
                        {{ c.showMetadataDiv ? 'Hide' : 'Show' }} Metadata
                    </button>
                    <img *ngIf="hasFormErrors()" src="imgs/icons/exclamation.png" alt="validation error"
                        class="error-icon" title="Form has validation errors" (click)="c.showMetadataDiv = true">
                </div>
            </div>

            <div *ngIf="c.showMetadataDiv" class="metadata-section">
                <div class="metadata-grid">
                    <div class="form-group">
                        <label [for]="c.id+'-displayLabel'" class="form-label">
                            Display Label
                            <span class="required-indicator">*</span>
                            <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                title="This is the label that will be displayed in the actual form">
                        </label>
                        <input type="text" class="form-control" [id]="c.id+'-displayLabel'"
                            placeholder="Enter display label" formControlName="displayLabel"
                            [class.is-invalid]="isFieldInvalid('displayLabel')"
                            [class.is-valid]="!isFieldInvalid('displayLabel') && dropdownForm.get('displayLabel')?.dirty">
                        <div class="invalid-feedback" *ngIf="isFieldInvalid('displayLabel')">
                            {{ getFieldError('displayLabel') }}
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Required Field
                            <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                title="Check if this field is mandatory in the form">
                        </label>
                        <div class="checkbox-container">
                            <input type="checkbox" [id]="c.id+'-required'" formControlName="required">
                            <label [for]="c.id+'-required'" class="checkbox-label">Make this field required</label>
                        </div>
                    </div>
                </div>

                <div class="form-group options-section">
                    <label class="form-label">
                        Options
                        <span class="required-indicator">*</span>
                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                            title="Add options for the dropdown. Each option must have both value and display text.">
                    </label>

                    <div formArrayName="options" class="options-container">
                        <div *ngFor="let option of optionsArray.controls; let i = index" [formGroupName]="i"
                            class="option-row">
                            <div class="option-number">{{i + 1}}.</div>
                            <div class="option-fields">
                                <div class="option-field">
                                    <input type="text" class="form-control" [id]="c.id+'-option-'+i+'-value'"
                                        placeholder="Value" formControlName="value"
                                        [class.is-invalid]="isOptionFieldInvalid(i, 'value')"
                                        [class.is-valid]="!isOptionFieldInvalid(i, 'value') && option.get('value')?.dirty">
                                    <div class="invalid-feedback" *ngIf="isOptionFieldInvalid(i, 'value')">
                                        {{ getOptionFieldError(i, 'value') }}
                                    </div>
                                </div>

                                <div class="option-field">
                                    <input type="text" class="form-control" [id]="c.id+'-option-'+i+'-display'"
                                        placeholder="Display Text" formControlName="display"
                                        [class.is-invalid]="isOptionFieldInvalid(i, 'display')"
                                        [class.is-valid]="!isOptionFieldInvalid(i, 'display') && option.get('display')?.dirty">
                                    <div class="invalid-feedback" *ngIf="isOptionFieldInvalid(i, 'display')">
                                        {{ getOptionFieldError(i, 'display') }}
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="remove-option-btn" (click)="removeOption(i)"
                                [disabled]="optionsArray.length <= 1" title="Remove option">
                                <img src="imgs/icons/delete.png" alt="delete" height="14px">
                            </button>
                        </div>
                    </div>

                    <div class="add-option-container">
                        <button type="button" class="add-option-btn" (click)="addOption()">
                            <img src="imgs/icons/add.png" alt="add" height="14px">
                            Add Option
                        </button>
                    </div>

                    <!-- Options validation error message -->
                    <div class="invalid-feedback options-validation-error" *ngIf="hasOptionsErrors()">
                        {{ getOptionsError() }}
                    </div>
                </div>

                <!-- Responsive Width Controls Section -->
                <div class="responsive-width-section">
                    <h4 class="section-title">Responsive Width Controls</h4>
                    <div class="responsive-width-grid">
                        <!-- Large Screen Controls -->
                        <div class="screen-size-group">
                            <h5 class="screen-size-title">Large Screen (1024px+)</h5>
                            <div class="width-controls">
                                <div class="form-group">
                                    <label [for]="c.id+'-containerWidthLarge'" class="form-label">
                                        Container Width
                                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                            title="Full-width: Takes entire line. Inline: Can share line with other inline components">
                                    </label>
                                    <select class="form-control" [id]="c.id+'-containerWidthLarge'" 
                                        formControlName="containerWidthInLargeScreen">
                                        <option value="full-width">Full Width</option>
                                        <option value="inline">Inline</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label [for]="c.id+'-componentWidthLarge'" class="form-label">
                                        Component Width
                                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                            title="Width in 12-column grid system (e.g., 4 = 4/12 = 33.33% width)">
                                    </label>
                                    <select class="form-control" [id]="c.id+'-componentWidthLarge'" 
                                        formControlName="componentWidthInLargeScreen">
                                        <option value="12">Full Width (12/12)</option>
                                        <option value="6">Half Width (6/12)</option>
                                        <option value="4">One Third (4/12)</option>
                                        <option value="3">Quarter (3/12)</option>
                                        <option value="2">One Sixth (2/12)</option>
                                        <option value="1">One Twelfth (1/12)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Medium Screen Controls -->
                        <div class="screen-size-group">
                            <h5 class="screen-size-title">Medium Screen (768px+)</h5>
                            <div class="width-controls">
                                <div class="form-group">
                                    <label [for]="c.id+'-containerWidthMedium'" class="form-label">
                                        Container Width
                                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                            title="Full-width: Takes entire line. Inline: Can share line with other inline components">
                                    </label>
                                    <select class="form-control" [id]="c.id+'-containerWidthMedium'" 
                                        formControlName="containerWidthInMediumScreen">
                                        <option value="full-width">Full Width</option>
                                        <option value="inline">Inline</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label [for]="c.id+'-componentWidthMedium'" class="form-label">
                                        Component Width
                                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                            title="Width in 12-column grid system (e.g., 4 = 4/12 = 33.33% width)">
                                    </label>
                                    <select class="form-control" [id]="c.id+'-componentWidthMedium'" 
                                        formControlName="componentWidthInMediumScreen">
                                        <option value="12">Full Width (12/12)</option>
                                        <option value="6">Half Width (6/12)</option>
                                        <option value="4">One Third (4/12)</option>
                                        <option value="3">Quarter (3/12)</option>
                                        <option value="2">One Sixth (2/12)</option>
                                        <option value="1">One Twelfth (1/12)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Small Screen Controls -->
                        <div class="screen-size-group">
                            <h5 class="screen-size-title">Small Screen (<768px)</h5>
                            <div class="width-controls">
                                <div class="form-group">
                                    <label [for]="c.id+'-containerWidthSmall'" class="form-label">
                                        Container Width
                                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                            title="Full-width: Takes entire line. Inline: Can share line with other inline components">
                                    </label>
                                    <select class="form-control" [id]="c.id+'-containerWidthSmall'" 
                                        formControlName="containerWidthInSmallScreen">
                                        <option value="full-width">Full Width</option>
                                        <option value="inline">Inline</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label [for]="c.id+'-componentWidthSmall'" class="form-label">
                                        Component Width
                                        <img class="info-icon" src="imgs/icons/info.png" alt="info"
                                            title="Width in 12-column grid system (e.g., 4 = 4/12 = 33.33% width)">
                                    </label>
                                    <select class="form-control" [id]="c.id+'-componentWidthSmall'" 
                                        formControlName="componentWidthInSmallScreen">
                                        <option value="12">Full Width (12/12)</option>
                                        <option value="6">Half Width (6/12)</option>
                                        <option value="4">One Third (4/12)</option>
                                        <option value="3">Quarter (3/12)</option>
                                        <option value="2">One Sixth (2/12)</option>
                                        <option value="1">One Twelfth (1/12)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div *ngIf="inputComponentDragService.showOverlay" [id]="c.id+'-overlay'"
        style="position:absolute; top:0; height: 100%; width: 100%; background-color: rgba(128, 128, 128, 0.205);">
    </div>
</div>