<app-gg-nav-bar></app-gg-nav-bar>
<!-- <app-gg-form-creator-nav-bar></app-gg-form-creator-nav-bar> -->


<div style="display: flex;">

  <div class="scrollable-div" style="width: 100px; height: calc(100vh - 78px); overflow-y: auto;">
    <app-gg-input-selection></app-gg-input-selection>
  </div>

  <div style=" height: calc(100vh - 78px);  overflow-y: auto; flex: 1; border-right: 1px solid lightgray;">

    <div class="form-name-container" *ngIf="showStructure">
      <div style="display: flex; align-items: center; padding: 0.5rem;">
        <div>Form Name</div>
        <div style="margin-left: auto">
          <button class="gg-btn" (click)="toggleShowStructure()">Show Preview</button>
        </div>
      </div>
    </div>

    <div class="form-name-container" *ngIf="!showStructure">
      <div style="display: flex; align-items: center; padding: 0.5rem;">
        <div>Form Name</div>
        <div style="margin-left: auto">
          <button class="gg-btn" (click)="toggleShowStructure()">Show Structure</button>
        </div>
      </div>
    </div>


    <app-gg-form-structure *ngIf="showStructure" [components]="formMetadataService.components"></app-gg-form-structure>
    <div style="margin: 1rem;">
      <form *ngIf="!showStructure" [formGroup]="mainFormGroup" (ngSubmit)="submit()">
        <app-form-renderer [formGroup]="mainFormGroup"
          [components]="formMetadataService.components"></app-form-renderer>
        <div class="submit-container">
          <button type="submit" class="submit-button">
            <svg viewBox="0 0 24 24" fill="currentColor" class="submit-icon">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            Submit Form
          </button>
        </div>
      </form>
    </div>

    <!-- Success Popup -->
    <div class="popup-overlay" *ngIf="showSuccessPopup" (click)="closeSuccessPopup()">
      <div class="popup-content success-popup" (click)="$event.stopPropagation()">
        <div class="popup-header success-header">
          <svg viewBox="0 0 24 24" fill="currentColor" class="popup-icon">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          <h3>Form Submitted Successfully!</h3>
          <button class="close-button" (click)="closeSuccessPopup()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="popup-body">
          <h4>Form Data:</h4>
          <pre class="json-display">{{ formData | json }}</pre>
        </div>
      </div>
    </div>

    <!-- Error Popup -->
    <div class="popup-overlay" *ngIf="showErrorPopup" (click)="closeErrorPopup()">
      <div class="popup-content error-popup" (click)="$event.stopPropagation()">
        <div class="popup-header error-header">
          <svg viewBox="0 0 24 24" fill="currentColor" class="popup-icon">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <h3>Form Validation Failed</h3>
          <button class="close-button" (click)="closeErrorPopup()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="popup-body">
          <h4>Please fix the following errors:</h4>
          <div class="error-list">
            <div *ngFor="let error of validationErrors" class="error-item">
              <span class="error-field">{{ error.field }}</span>
              <span class="error-message">{{ error.message }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>



  </div>



  <div class="json-preview" style="width: 400px; height: calc(100vh - 78px);  overflow-y: auto;">
    <!-- Show JSON preview -->
    <pre>{{ this.formMetadataService.components |json}}</pre>
  </div>


</div>